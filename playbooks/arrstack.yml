---

- name: Setup Arr stack with Buildarr
  hosts: arrstack
  become: true
  pre_tasks:
    - name: remove podman docker
      ansible.builtin.dnf:
        name: 
          - docker
          - podman-docker
          - podman
        state: absent
    - name: add docker ce repo
      ansible.builtin.command:
        cmd: dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
    - name: update dnf
      ansible.builtin.dnf:
        name: "*"
        state: latest
    - name: install docker
      ansible.builtin.dnf:
        name: 
          - docker-ce
        state: latest
    - name: start docker service
      ansible.builtin.systemd_service:
        name: docker
        state: started
        enabled: true
  vars: 
    arrstack_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36383833386262333733393430663632653331633063363134376535316232613438333331323535
          3832333433343833376263656131633737613762336666660a356161333331666338363165383163
          62303631373938646532623133393030313866353434663839623333626266303236366433363363
          3961323536386637340a343065333633303630663362353764643832376666346138393965323338
          65623437666665633162303163613064353565613530646435653537323366366438
  roles:
    - ../roles/arrstack
  tags: 
    - arrstack

#- name: Deploy Media Stack on configured hosts
#  hosts: arrstack
#  become: true
#  pre_tasks:
#    - name: remove podman docker
#      ansible.builtin.dnf:
#        name: 
#          - docker
#          - podman-docker
#          - podman
#        state: absent
#    - name: add docker ce repo
#      ansible.builtin.command:
#        cmd: dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
#    - name: update dnf
#      ansible.builtin.dnf:
#        name: "*"
#        state: latest
#    - name: install docker
#      ansible.builtin.dnf:
#        name: 
#          - docker-ce
#        state: latest
#    - name: start docker service
#      ansible.builtin.systemd_service:
#        name: docker
#        state: started
#        enabled: true
#  roles:
#    - buildarr.mediastack.base
##    - buildarr.mediastack.jellyfin
#    - buildarr.mediastack.transmission
#    - buildarr.mediastack.flaresolverr
#    - buildarr.mediastack.sonarr
#    - buildarr.mediastack.radarr
#    - buildarr.mediastack.prowlarr
#    - buildarr.mediastack.jellyseerr
#    - buildarr.mediastack.buildarr